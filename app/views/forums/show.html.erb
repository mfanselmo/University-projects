<div class="container">
  <!-- Sin esto no funciona -->
  <% post_de_este_foro = @forum.posts.all %>  

  <p id="titlesForum">
    <%= @forum.name %>
  </p>
  
  <div class="row-fluid" style="padding-top: 1em; background-color: white; border-radius: 5px;">
    <div class="col-sm-6" style="background-color:white;"><%= @forum.description %></div>
    <div class="col-sm-6" style="background-color:white;">
      <% sub_count = subscriptores(@forum).length %>
      <% if sub_count == 1 %>
        <p id="subs_count"><%= sub_count %> suscriptor</p>
      <% else %>
        <p id="subs_count"><%= sub_count %> suscriptores</p>
      <% end %>
    </div>
  </div>
  <div class="row-fluid" style="background-color: white;padding-bottom: 5em;border-radius: 5px; margin-bottom: 2em;">
    <div class="col-sm-6" style="background-color:white;">
      <% if user_signed_in? %>

        <% if subscripciones(current_user).include? @forum.id  %>
          <td><a class='btn btn-default btn-xs' id= "subs_button_<%=@forum.id%>" 
            onclick="unsubs(<%= Subscription.find_by(:user_id => current_user.id, 
            :forum_id => @forum.id).id %>)">Desuscribirse</a></td>
        <% else %>
          <td><a class='btn btn-default btn-xs' id= "subs_button_<%=@forum.id%>" 
            class="link_normal" onclick="subs(<%=current_user.id%>, <%=@forum.id%>)">Suscribirse</a></td>
        <% end %>
      <% end %>

    </div>
    <div class="col-sm-6" style="background-color:white;">
      <% if user_signed_in? and not current_user.admin? %>

      <%  if moderadores(@forum).include? current_user.id %>
        <p id="postulate_text"> Eres moderador </p>
        <a id="action_postulate" onclick="unmoderate(<%=Moderator.find_by(:user_id => current_user.id, :forum_id => @forum.id).id%>, <%=current_user.id%>, <%=@forum.id%>)" class="link_normal">Dejar de ser moderador</a>

        <% elsif points_user(@forum, current_user) >= 5 and not esta_postulando(current_user, @forum)%>
        <p id="postulate_text"> Podrias ser moderador de este foro! </p>
        <%#= link_to "Postular", postulations_path(:user_id => current_user.id, :forum_id => @forum.id), :method => :post%>
        <a id="action_postulate" onclick="postulate(<%=current_user.id%>, <%=@forum.id%>)" class="link_normal">Postular </a>
        <% elsif points_user(@forum, current_user) >= 5 and esta_postulando(current_user, @forum)%>
        <p> Ya estas postulando para ser moderador de este foro!  </p>
      <% end %>
    <% end %> 

    <% if user_signed_in? and current_user.admin? %>
      <%= link_to 'Editar foro', edit_forum_path(@forum), :id => "link_normal" %> 
    <% end %>
    </div>
  </div>
  
  <% if user_signed_in? %>
    <div class="row-fluid" style="background-color: white;padding: 1em 1em 1em 1em; margin-bottom: 1em; margin-top: 1em; border-radius: 5px;">
     
      <%= form_for([@forum, @forum.posts.build]) do |f| %>
      <div class="field">
        <%= f.text_field :name, value: current_user.username, style: "#{'display:none';}" %><br />
      </div>
      <div class="form-group">
        <%= f.text_field :title, class: 'form-control', placeholder: 'Titulo' %>
      </div>

      <div class="form-group">
        <%= f.text_area :content, class: 'form-control', placeholder:'Contenido' %>
      </div>

      <div class="field">
        <%= f.file_field :image %>
      </div>

      
      <label class="btn btn-primary">
        Submit
        <span style="display:none;">
          <%= f.submit  %>
        </span>
      </label>
        
        
    <% end %>

  </div>
  <% end %>
  

  <div class="row-fluid" style="background-color: white; padding: 1em 1em 1em 1em; border-radius: 5px;margin-bottom: 5em;">
    <% if @forum.posts.count == 0%>
      <h4>No hay nada creado</h4>
      <h4>Se el primero!</h4>
      <% if not user_signed_in? %>
        <%= link_to "Registate", new_user_registration_path, method: :get, :id=> "titulo_sub"  %> o
       <%= link_to "Inicia sesion", new_user_registration_path, method: :get,:id=> "titulo_sub"  %>
      <% end %>
    <% end %>

    <% @posts.each do |post| %>
      <%= render 'index/todos_los_post', post: post, mi_tipo: "cada_post_2"%>
    <% end %>
    <%= will_paginate @posts %>
  </div>



</div>
